---
layout: post
title: "[ RustğŸ¦€ ] Rust ì˜ ì†Œìœ ê¶Œ "
description: Rust ì˜ ì†Œìœ ê¶Œ ê°œë…ì— ëŒ€í•´ ì•Œì•„ë³´ì
project-header: true
type: "Development"
blog: true
text: true
author: "Donghyun Kim"
post-header: true
header-img: "img/rust-crab.png"
order: 2
---

> Rust ì˜ ì–¸ì–´ë¡œì„œì˜ ë³´í¸ì ì¸ ê¸°ëŠ¥ì„ ì•Œ ìˆ˜ ìˆë‹¤.

ì´ì „ í¬ìŠ¤íŠ¸ì—ì„œ Rust ì˜ ê¸°ë³¸ì ì¸ ì†ì„±ë“¤ì„ ì•Œì•„ ë³´ì•˜ë‹¤.
ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œëŠ” Rust ì˜ í•µì‹¬ ê°œë…ì´ë¼ê³  í•  ìˆ˜ ìˆëŠ” `ì†Œìœ ê¶Œ` ì— ëŒ€í•´ ì•Œì•„ë³´ì.

# ì†Œìœ ê¶Œì´ ë­”ê°€ìš”? ( Ownership )

ìš°ë¦¬ëŠ” ì´ì „ì— ì‚¬ìš©í•˜ë˜ ì–¸ì–´ë“¤ì„ ì“°ë©´ì„œ, ë³€ìˆ˜ì˜ ìœ íš¨ì„±ì— ë”°ë¥¸ ì˜¤ë¥˜ë¥¼ ë§ì´ ê²ªì–´ì™”ë‹¤.

- ë™ì  í• ë‹¹ì„ ë„ˆë¬´ ë§ì´ ì‚¬ìš©í•˜ì—¬ ìƒê¸°ëŠ” `memory leak`
- memory leak ì„ í•´ê²°í•˜ê¸° ìœ„í•´ JAVA ì—ì„œ ë„ì…í•œ `GC(Garbage Collector)`
- ë™ì¼í•œ heap ì˜ì—­ì„ ê°€ë¥´í‚¤ê³  ìˆëŠ” ë³€ìˆ˜ë“¤ ë•Œë¬¸ì— ìƒê¸°ëŠ” `Dangling Pointer`
- ìœ íš¨í•œ ê°’ì„ ê°€ë¥´í‚¤ê³  ìˆì§€ ì•Šì€ í¬ì¸íŠ¸ ë“¤ ë•Œë¬¸ì— ìƒê¸°ëŠ” `Exception` ë“¤ ..

Rust ëŠ” ì´ëŸ¬í•œ ë¬¸ì œë“¤ì„ í•´ê²°í•˜ê¸° ìœ„í•´ `ì†Œìœ ê¶Œ` ì´ë¼ëŠ” ê°œë…ì„ ë„ì…í–ˆë‹¤.
\
\
ì†Œìœ ê¶Œì´ë€, ë³€ìˆ˜ê°€ ì–´ë–¤ ê°’ì„ **ì†Œìœ ** í•  ìˆ˜ ìˆëŠ” ê²ƒì„ ë§í•œë‹¤. \
ì•ì„œ, Rust ì˜ ì†Œìœ ê¶Œì— ëŒ€í•œ ê·œì¹™ì„ ì•Œì•„ë³´ì.


1. ëŸ¬ìŠ¤íŠ¸ì˜ ê°ê°ì˜ ê°’ì€ í•´ë‹¹ê°’ì˜ ì˜¤ë„ˆ(owner)ë¼ê³  ë¶ˆë¦¬ìš°ëŠ” ë³€ìˆ˜ë¥¼ ê°–ê³  ìˆë‹¤.
2. í•œë²ˆì— ë”± í•˜ë‚˜ì˜ ì˜¤ë„ˆë§Œ ì¡´ì¬í•  ìˆ˜ ìˆë‹¤.
3. ì˜¤ë„ˆê°€ ìŠ¤ì½”í”„ ë°–ìœ¼ë¡œ ë²—ì–´ë‚˜ëŠ” ë•Œ, ê°’ì€ ë²„ë ¤ì§„ë‹¤(dropped).

\
Rust ëŠ” ì´ëŸ¬í•œ `ì†Œìœ ê¶Œ` ì„ í†µí•´, JAVA ê°™ì€ ë³„ë„ì˜ GCë„ ë‘ì§€ ì•Šìœ¼ë©´ì„œ, C ì²˜ëŸ¼ memory leak ì˜ ìœ„í—˜ë„ ì—†ëŠ” ì•ˆì •ì„±ì„ êµ¬í˜„í•´ ëƒˆë‹¤.

# ë³€ìˆ˜ì˜ ìŠ¤ì½”í”„ ( Scope )

íƒ€ ì–¸ì–´ì™€ ë™ì¼í•˜ê²Œ, Rust ì˜ ë³€ìˆ˜ë„ `ìŠ¤ì½”í”„(Scope)` ë¥¼ ê°€ì§„ë‹¤.
ë³€ìˆ˜ëŠ” í•´ë‹¹ ìŠ¤ì½”í”„ ë‚´ì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, ìŠ¤ì½”í”„ë¥¼ ë²—ì–´ë‚  ì‹œ ìë™ìœ¼ë¡œ `Drop` ëœë‹¤.

{% highlight js %}

{
    let s = String::from("hello"); // sëŠ” ì—¬ê¸°ì„œë¶€í„° ìœ íš¨í•©ë‹ˆë‹¤
}                                  // ì´ ìŠ¤ì½”í”„ëŠ” ëë‚¬ê³ , sëŠ” ë” ì´ìƒ 
                                   // ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤

{% endhighlight %}

# ë³€ìˆ˜ì™€ ê°’ì˜ ê´€ê³„ : ì´ë™ ( Move )

ë¨¼ì € ì¼ë°˜ì ìœ¼ë¡œ ë³€ìˆ˜ê°„ ê°’ì„ ë³µì‚¬í•˜ëŠ” ì½”ë“œì˜ ì˜ˆì œë¥¼ ë³´ì.

{% highlight js %}

fn main () {
    let x: i32 = 10;
    let y: i32 = x;

    println!("x : {}, y : {}", x, y);
}

{% endhighlight %}

ìœ„ ì½”ë“œëŠ” y ì˜ ê°’ì„ x ì— ë³µì‚¬í•˜ëŠ” ê²ƒì´ê³ , ì•„ë¬´ ë¬¸ì œ ì—†ì´ ë™ì‘í•œë‹¤.

ê·¸ëŸ¬ë©´, ìœ„ì™€ ê°™ì€ ê²½ìš°ë¥¼ String ì— ì ìš©í•´ ë³´ì.

{% highlight js %}

fn main () {
    let x: String = String::from("hello, world!");
    let y: String = x;

    println!("x : {}, y : {}", x, y);
}

{% endhighlight %}

ì´ì „ì˜ ì½”ë“œì™€ ì°¨ì´ëŠ” int íƒ€ì…ì—ì„œ String ì¸ íƒ€ì…ìœ¼ë¡œ ë°”ë€ ê²ƒ ë¿ì´ë¯€ë¡œ, ì´ ì½”ë“œë„ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ì•¼ í•  ê²ƒ ê°™ì§€ë§Œ, \
ì‹¤ì œë¡œ ì»´íŒŒì¼í•´ë³´ë©´, ì•„ë˜ì™€ ê°™ì€ ì»´íŒŒì¼ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.

{% highlight js %}

error[E0382]: borrow of moved value: `x`
 --> src/main.rs:6:32
  |
3 |     let x: String = String::from("hello, world!");
  |         - move occurs because `x` has type `std::string::String`, which does not implement the `Copy` trait
4 |     let y: String = x;
  |                     - value moved here
5 | 
6 |     println!("x : {}, y : {}", x, y);
  |                                ^ value borrowed here after move
  
{% endhighlight %}

ìœ„ ì˜¤ë¥˜ì—ì„œ ë‘ ì¤‘ìš”í•œ ë¬¸êµ¬ë¥¼ ë³¼ ìˆ˜ ìˆëŠ”ë°, ì²«ì§¸ëŠ” **value moved here** ì´ê³ , ë‘˜ì§¸ëŠ” **value borrowed here after move**  ì´ë‹¤. \
ë‘ ë¬¸êµ¬ê°€ ë°”ë¡œ Rust ì˜ ì†Œìœ ê¶Œ ë•Œë¬¸ì— ë°œìƒí•œ ì˜¤ë¥˜ì¸ë°, 4ë²ˆì§¸ ì¤„ `x = y` ì—ì„œ "hello, world!" String ì— ëŒ€í•œ ì†Œìœ ê¶Œì´ x ì—ì„œ y ë¡œ ì´ë™í–ˆ ë²„ê³ ,\
ê·¸ ì´í›„ 6ë²ˆì§¸ ì¤„ì—ì„œ x ëŠ” String ì— ëŒ€í•œ `ì†Œìœ ê¶Œ` ì„ ê°€ì§€ê³  ìˆì§€ ì•Šì§€ë§Œ ì¶œë ¥í•˜ë ¤ í–ˆê¸° ë•Œë¬¸ì— ë°œìƒí•œ ì˜¤ë¥˜ì´ë‹¤.\
ì´ì²˜ëŸ¼ ì†Œìœ ê¶Œì„ ê°€ì§„ ë³€ìˆ˜ë¥¼ 1ê°œë¡œ ìœ ì§€í•¨ìœ¼ë¡œì¨, `Dangling Pointer` ì˜ ì°¸ì¡°ì— ë”°ë¥¸ ì˜¤ë¥˜ë¥¼ ì—†ì•¨ ìˆ˜ ìˆê³ ,\
ì†Œìœ ê¶Œì„ ê°€ì§„ ë³€ìˆ˜ê°€ Scope ì„ ë²—ì–´ë‚  ë•Œ ê°’ë„ í•¨ê»˜ `Drop` ì‹œí‚´ìœ¼ë¡œì¨ `memory leak` ë„ ë°©ì§€í•  ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤. \ 
\\

ê·¸ë ‡ë‹¤ë©´, ì²«ë²ˆì§¸ ê²½ìš°ì— ì»´íŒŒì¼ ì˜¤ë¥˜ê°€ ë‚˜ì§€ ì•Šì•˜ë˜ ì´ìœ ëŠ” ë¬´ì—ˆì¼ê¹Œ?\
ì°¨ì´ëŠ” ë°”ë¡œ, ì²«ë²ˆì§¸ëŠ” `primitive` í˜•ì˜ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í–ˆê³ , ë‘ë²ˆì§¸ëŠ” `reference` í˜•ì˜ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í–ˆë‹¤ëŠ” ê²ƒì´ë‹¤.\
\
ì´ëŠ” ë‹¤ìŒ ë¬¸ë‹¨ì—ì„œ ì„¤ëª…í•˜ê² ë‹¤.
\
# ë³€ìˆ˜ì™€ ê°’ì˜ ê´€ê³„ : ë³µì‚¬ ( Copy )

Rust ì—ì„œë„ ë³€ìˆ˜ê°„ ê°’ì„ ëŒ€ì…í•  ë•Œ, í•­ìƒ ì†Œìœ ê¶Œì˜ ì´ë™ì´ ì¼ì–´ë‚˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤. \
ê°’ì˜ ì†Œìœ ê¶Œì´ ì´ë™ë˜ì§€ ì•Šê³ , ê°’ ìì²´ê°€ ë³µì‚¬ë˜ëŠ” ê²½ìš°ê°€ ìˆëŠ”ë°, ì´ëŠ” ë³€ìˆ˜ê°€ STACK ì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆëŠ” ( ì»´íŒŒì¼ íƒ€ì„ì— í¬ê¸°ë¥¼ ì•Œ ìˆ˜ ìˆëŠ” )
`primitive` í•œ ê°’ì¼ ê²½ìš°ì´ë‹¤.

ê°’ì´ ë³µì‚¬ë˜ëŠ” íƒ€ì…ì€ ì•„ë˜ì™€ ê°™ë‹¤.

- u32ì™€ ê°™ì€ ëª¨ë“  ì •ìˆ˜í˜• íƒ€ì…ë“¤
- trueì™€ falseê°’ì„ ê°–ëŠ” ë¶€ìš¸ë¦° íƒ€ì… bool
- f64ì™€ ê°™ì€ ëª¨ë“  ë¶€ë™ ì†Œìˆ˜ì  íƒ€ì…ë“¤
- Copyê°€ ê°€ëŠ¥í•œ íƒ€ì…ë§Œìœ¼ë¡œ êµ¬ì„±ëœ íŠœí”Œë“¤. (i32, i32)ëŠ” Copyê°€ ë˜ì§€ë§Œ, (i32, String)ì€ ì•ˆë©ë‹ˆë‹¤.

ë˜í•œ ìì‹ ì´ ì§ì ‘ ë§Œë“  êµ¬ì¡°ì²´ì—ë¥¼ Copy ë˜ê²Œ í•  ìˆ˜ ë„ ìˆëŠ”ë°, ì•„ë˜ì²˜ëŸ¼ Copy trait ì„ êµ¬í˜„í•˜ë©´ ëœë‹¤. ( ìì„¸í•œ ë‚´ìš©ì€ ë‚˜ì¤‘ì— ë‹¤ë£¨ê² ë‹¤. )

{% highlight js %}

#[derive(Copy,Clone,Debug)]  // Copy trait êµ¬
#[derive(Debug)]
struct mystruct {
    x: i32,
    y: i32
}
impl mystruct {
    fn new(_x: i32, _y: i32) -> mystruct {
        mystruct{x: _x, y: _y}
    }
}
fn main () {
    let a = mystruct::new(1,1);
    let b = a;          // Copy Trait ì„ êµ¬í˜„í•¨ìœ¼ë¡œì¨,
    print!("{:?}",a);   // ê°’ì„ ì´ë™ì‹œì¼°ì§€ë§Œ Copy ë˜ì–´ ì»´íŒŒì¼ ì˜¤ë¥˜ ë°œìƒí•˜ì§€ x
}

{% endhighlight %}


## References

- [rust-lang-book-ko](https://rinthel.github.io/rust-lang-book-ko/foreword.html)
